---
layout: post
title: "Calling ASP.NET AJAX web-services from JQuery"
comments: true
---
<p>I recently looked into calling ASP.NET Ajax web-services from JQuery, and it&rsquo;s actually not that hard.</p>
<h2>The ASP.NET Ajax web-service</h2>
<p>To create a client script enabled web-service, add the [ScriptService] to the web service class. This makes sure that the methods can be called from client script and also makes the returntype a JSON.</p>
<pre class="brush: csharp; gutter: false">[WebService(Namespace = "http://tempuri.org/")]
[WebServiceBinding(ConformsTo = WsiProfiles.BasicProfile1_1)]
[ScriptService]
public class AjaxWebservice : System.Web.Services.WebService
{
    [WebMethod]
    public string HelloWorld()
    {
        return "Hello World - " + DateTime.Now.ToShortTimeString();
    }

    [WebMethod]
    public object HelloObject(int id)
    {
        return new { Id = id, Success = true, Text="&lt;b&gt;It went well!&lt;/b&gt;" };
    }
}</pre>
<p>Note that the returned object in the last webservice method, is converted to a JSON object, which we will see shortly can be used very easily in the client.</p>
<h2>The client-side JQuery ajax call</h2>
<p>Now we have the ajax web service done, in .net manner, we would like to use JQuery&rsquo;s easy and simple interface to consume it.</p>
<p>The default way to create an asynchronous client side call using JQuery is via an $.ajax() call <br />( see <a href="http://docs.jquery.com/Ajax">http://docs.jquery.com/Ajax</a> for more details on this)</p>
<p>The client-side script able to consume the HelloObject webmethod, looks like this:</p>
<pre class="brush: js; gutter: false">$.ajaxSetup({
  type: "POST",
  contentType: "application/json; charset=utf-8",
  data: "{}",
  dataFilter: function(data) {
    var msg;

    if (typeof (JSON) !== 'undefined' &amp;&amp;
    typeof (JSON.parse) === 'function')
      msg = JSON.parse(data);
    else
      msg = eval('(' + data + ')');

    if (msg.hasOwnProperty('d'))
      return msg.d;
    else
      return msg;
  }
});

$.ajax({
  url: "AjaxWebservice.asmx/HelloObject",
  data: "{id:3}",
  success: function(msg) {
    if (msg.Success) {
      alert("yes: " + msg.Text + "(" + msg.Id + ")");
    }
    else {
      alert("nop: " + msg.Text + "(" + msg.Id + ")");
    }
  }
});</pre>
<p>The first $.ajaxSetup() part, sets the default values for all subsequent ajax calls, and the last $.ajax() call makes the asynchronous request to the server. The dataFilter function is supposed to even out some of the variations, different version of net handle JSON, but i haven&rsquo;t gone that much in detail with it. ( go here to read more about it : <a href="http://encosia.com/2009/07/21/simplify-calling-asp-net-ajax-services-from-jquery/">http://encosia.com/2009/07/21/simplify-calling-asp-net-ajax-services-from-jquery/</a>)</p>
<p>This example calls the the webserver with an id having the value two, which then responds with a JSON object. When the client side successfully completes the request, it creates an alertbox from the data in the returned JSON object.</p>
<p>Sources: <br /><a href="http://encosia.com/2009/07/21/simplify-calling-asp-net-ajax-services-from-jquery/">http://encosia.com/2009/07/21/simplify-calling-asp-net-ajax-services-from-jquery/</a> <br /><a href="http://encosia.com/2008/06/05/3-mistakes-to-avoid-when-using-jquery-with-aspnet-ajax/">http://encosia.com/2008/06/05/3-mistakes-to-avoid-when-using-jquery-with-aspnet-ajax/</a> <br /><a href="http://docs.jquery.com/Ajax">http://docs.jquery.com/Ajax</a></p>
